{% extends 'base.html' %}
{% load static %}
{% block content %}

{% if project.id %}
{% include 'students/navbar.html' %}
{% endif%}
<br><br>
<style>
  .errorlist{
    color:red ;
  }
  input {  
  width: 60%;
  padding: 12px 20px;
  box-sizing: border-box;
  border: 2px solid #ccc;
  border-radius: 4px;
  background-color: #f8f8f8;
  font-size: 16px;
  height: 20px;
}
</style>
<a class="btn btn-outline-danger" href="/accounts/logout" style="color: red; align-items: right;" > logout </a> <br><br>

<div class="card rounded-top border border-1 p-3">
  
  {% for message in messages %}
  <div class="container-fluid p-0">
    <div class="alert {{ message.tags }} alert-dismissible" role="alert" >
      <button onClick="window.location.href=window.location.href" type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="True">&times;</span>
      </button>
      {{ message }}
    </div>
  </div>
  {% endfor %}

  {% for n in notice %}    
    <div class="alert alert-primary alert-dismissible fade show" role="alert">
      <strong></strong>{{ n.notice|safe }}.
      <form action="{% url 'read_true' n.pk %}" method="post">
        {% csrf_token %}                                                  
        <input type="hidden" name="student_id" value="{{object.student.user.id}}">
        <button type="submit" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>  
      </form>
      
    </div>
  {% endfor %}  

  <div class="card-header">
    Student Dashboard 
  </div>
  
      {% if project.id %}
      <div class="container-fluid p-0">
        <div class="rounded border border-2 p-2 m-3" style="background-color: rgba(67, 95, 219, 0.808);">
          <p style="color: rgb(255, 255, 255);" class="text-center">Project Status: {{project.status}}</p>
          <p style="color: rgb(255, 255, 255);" class="text-center">Cummulative: {{ result.cummulative }}</p>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ result.cummulative }}" aria-valuenow="{{ result.cummulative }}" aria-valuemin="0" aria-valuemax="100"> {{ result.cummulative }} </div>
          </div>    
        </div>
      </div>
     
      {% else %}
      <p style="color: red;" class="text-center" > NO SUPERVISOR YET</p>
      {% endif %}

    
  <div class="card-body">
    {% if project.id %}
    <div class="text-center">
      <img src="/media/{{project.student.user.profile_pix}}" class="rounded-circle z-depth-2" alt="" height="200px" width="200px">
    </div>
    <br><br> <img height="50px" src="{% static 'img/folder.svg' %}" alt="title">
    <h4 class="card-title mb-3">Project Topic: {{ project.topic }}</h4>    
    <p class="lead">Full name: {{ project.student.user.first_name }}&nbsp; {{ project.student.user.last_name }}
     <br> Institution: {{ project.student.user.institution }}
     <br> Department: {{ project.student.user.department }}         
     <br> Project Supervisor: {{ project.supervisor }}
    </p>
    {% if project.status == 'disapproved' %} <br><br>
    <p class="lead">      
      <form class="form-control p-2" action="{% url 'project_title_update' project.pk %}" method="post">
        {% csrf_token %}                                                  
        <input type="hidden" name="supervisor_id" value="{{project.supervisor.user.id}}">
        <label for="topic"> Project topic </label><br> 
        <input  type="text" name="topic"  placeholder="update your project topic...."/>         
        <p style="color: red;" ><i> {{ form.errors }} </i></p>         
        <button type="submit" class="btn btn-success"> send </button> 
      </form>      
    </p>
    {% endif %}
    <p class="lead"></p>
    <p class="lead"></p>
    <p class="lead"></p>
    <p class="lead"></p>
    <!-- <p class="card-text">Project Student: {{ project.student }}</p> -->
    <!-- <small> Project ID: {{project.id}} </small> -->
    {% endif %}
  </div>  
</div>


<br><br><br>
{% if project.status == 'disapproved' %}
<h5 style="color: red;" >Your project status is disapproved, You can't perform upload actions. Message your supervisor. <br><br><br></h5>
{% else %}

{% if project.id %}
  <h3 class="text-center" >Uploaded Projects <br><br>   
    <a href="{% url 'project_upload' %}" class="btn btn-success">Upload new project content</a>
  {% endif %}

</h3>

<br>
<a href="#" id="uploadedprojects" ></a>{% if project_uploads %}
<table class="table align-middle mb-0 bg-white">
  <thead class="bg-light">
    <tr>
      <th>Title</th>
      <th>Status</th>     
    </tr>
  </thead>
  <tbody>
    
    {% for i in project_uploads %}       
    <tr>
      <td>
        <div class="d-flex align-items-center">
          <img
              src="/media/{{i.student.user.profile_pix}}"
              alt=""
              style="width: 45px; height: 45px"
              class="rounded-circle"
              />
          <div class="ms-3">
            <p class="fw-bold mb-1"><a href="{%  url 'project_upload_detail' i.pk %}"> {{i.title}} </a></p>
            <p class="text-muted mb-0">{{ project.title }} ( Grade: {{ i.grade }} )</p>
            <p class="text-muted mb-0"><small>{{i.created_on}}</small></p>
          </div>
        </div>
      </td>
      <td>
        {% if i.status == 'approved' %}
        <p class="fw-normal mb-1" style="color: green;"> <img height="20px" src="{% static 'img/done.svg' %}" alt=""> {{i.status}} </p>
        <!-- <p class="text-muted mb-0">IT department</p> -->
        {% endif %}

        {% if i.status == 'declined' %}
        <p class="fw-normal mb-1" style="color: red;"> <img height="20px" src="{% static 'img/declined1.svg' %}" alt=""> {{i.status}} </p>
        <!-- <p class="text-muted mb-0">IT department</p> -->
        {% endif %}

        {% if i.status == 'pending' %}
        <p class="fw-normal mb-1" style="color: blue;"> <img height="20px" src="{% static 'img/pending.svg' %}" alt=""> {{i.status}} </p>
        <!-- <p class="text-muted mb-0">IT department</p> -->
        {% endif %}
         
      </td>
     
    </tr>
    {% endfor %}
  {% endif  %}
  {% endif %}
  </tbody>
</table>

{% endblock %}

{% block js %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endblock %}